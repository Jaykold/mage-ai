(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5378],{16488:function(n,e,t){"use strict";t.d(e,{IJ:function(){return E},M8:function(){return R},Uc:function(){return O},XM:function(){return b},_U:function(){return p},eI:function(){return T},gU:function(){return S},lO:function(){return x},ri:function(){return g},tL:function(){return h},vJ:function(){return C},xH:function(){return N}});var r,u=t(82394),o=t(92083),i=t.n(o),c=t(3917),l=t(4383),a=t(30229),s=t(42122),f=t(86735);function d(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function v(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?d(Object(t),!0).forEach((function(e){(0,u.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var p=function(n){return!!n&&!Object.values(a.U5).includes(n)};function E(n){return null==n?void 0:n.reduce((function(n,e){var t=e.block_uuid,r=e.completed_at,o=e.started_at,c=e.status,l=null;o&&r&&(l=i()(r).valueOf()-i()(o).valueOf());return v(v({},n),{},(0,u.Z)({},t,{runtime:l,status:c}))}),{})}var m,g=function(n){var e=[{description:function(){return"This pipeline will run continuously on an interval or just once."},label:function(){return"Schedule"},uuid:a.Xm.TIME},{description:function(){return"This pipeline will run when a specific event occurs."},label:function(){return"Event"},uuid:a.Xm.EVENT},{description:function(){return"Run this pipeline when you make an API call."},label:function(){return"API"},uuid:a.Xm.API}];return n?e.slice(0,1):e};function N(n){var e=(0,s.gR)(n,[a.gm.INTERVAL,a.gm.TYPE]),t=n[a.gm.INTERVAL];t&&(e["schedule_interval[]"]=encodeURIComponent(t));var r=n[a.gm.TYPE];return r&&(e["schedule_type[]"]=r),e}function T(n){return n?new Date(i()(n).valueOf()):null}function O(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e?(0,c.XG)(n,e,t):function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"!=typeof n)return n;var t=n.split("+")[0];return i()(T(t)).format(e||c.Nx)}(n,t)}!function(n){n.DAY="day",n.HOUR="hour",n.MINUTE="minute",n.SECOND="second"}(m||(m={}));var h=(r={},(0,u.Z)(r,m.DAY,86400),(0,u.Z)(r,m.HOUR,3600),(0,u.Z)(r,m.MINUTE,60),(0,u.Z)(r,m.SECOND,1),r);function S(n){var e=m.SECOND,t=n;return n%86400==0?(t/=86400,e=m.DAY):n%3600==0?(t/=3600,e=m.HOUR):n%60==0&&(t/=60,e=m.MINUTE),{time:t,unit:e}}function C(n,e){return n*h[e]}function b(n,e,t){var r,u=i()(n);return u.set("hour",+(null==e?void 0:e.hour)||0),u.set("minute",+(null==e?void 0:e.minute)||0),u.set("second",0),r=u.format(c.TD),null!=t&&t.includeSeconds&&(r=r.concat(":00")),null!=t&&t.localTimezone&&(r=u.format(c.lE),null!=t&&t.convertToUtc&&(r=(0,c.d$)(r,{includeSeconds:null==t?void 0:t.includeSeconds,utcFormat:!0}))),r}function R(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t="",r=(0,l.XF)();return e?t="".concat(r,"/api/pipeline_schedules/").concat(null==n?void 0:n.id,"/api_trigger"):(t="".concat(r,"/api/pipeline_schedules/").concat(null==n?void 0:n.id,"/pipeline_runs"),null!=n&&n.token&&(t="".concat(t,"/").concat(n.token))),t}function _(n,e,t){return n.match(/[*,-/]/)?{additionalOffset:0,cronValue:n}:function(n,e,t){var r=t.indexOf(n),u=0;if(e<0)for(var o=0;o>e;o--)0===r?(r=t.length-1,u-=1):r-=1;else if(e>0)for(var i=0;i<e;i++)r===t.length-1?(r=0,u+=1):r+=1;var c="number"==typeof t[r]?t[r]:n;return{additionalOffset:u,cronValue:String(c)}}(+n,e,t)}var I=(0,f.m5)(60),Z=(0,f.m5)(24),P=(0,c.Cs)();function x(n,e){if(!n)return n;var t=i()().local().format("Z"),r=t.split(":"),u="-"===t[0],o=3===r[0].length?Number(r[0].slice(1)):Number(r[0]),c=Number(r[1]);(u&&!e||!u&&e)&&(o=-o,c=-c);var l=n.split(" "),a=l[0],s=l[1],f=l[2],d=_(a,c,I),v=_(s,o+d.additionalOffset,Z);if(l[0]=d.cronValue,l[1]=v.cronValue,0!==(null==v?void 0:v.additionalOffset)){var p=_(f,v.additionalOffset,P);l[2]=p.cronValue}return l.join(" ")}},10360:function(n,e,t){"use strict";t.d(e,{Vb:function(){return o},Wk:function(){return f},XM:function(){return c},YI:function(){return a},n2:function(){return d},nR:function(){return i}});var r,u,o,i,c,l,a,s=t(82394);!function(n){n.INTERRUPT="interrupt",n.RESTART="restart",n.TERMINATE="terminate"}(o||(o={})),function(n){n[n.CONNECTING=0]="CONNECTING",n[n.OPEN=1]="OPEN",n[n.CLOSED=2]="CLOSED"}(i||(i={})),function(n){n.DATA="data",n.OUTPUT="output",n.STATUS="status",n.STDOUT="stdout"}(c||(c={})),function(n){n.EXECUTION="execution",n.EXECUTION_STATUS="execution_status",n.TASK="task",n.TASK_STATUS="task_status"}(l||(l={})),function(n){n.CANCELLED="cancelled",n.ERROR="error",n.FAILURE="failure",n.INIT="init",n.INTERRUPTED="interrupted",n.READY="ready",n.RESTARTED="restarted",n.RUNNING="running",n.SUCCESS="success",n.TERMINATED="terminated"}(a||(a={}));var f,d=(r={},(0,s.Z)(r,a.CANCELLED,"cancelling"),(0,s.Z)(r,a.INIT,"initializing"),(0,s.Z)(r,a.INTERRUPTED,"interrupting"),(0,s.Z)(r,a.RESTARTED,"restarting"),(0,s.Z)(r,a.SUCCESS,"succeeded"),(0,s.Z)(r,a.TERMINATED,"terminating"),r);!function(n){n.CLOSED="closed",n.CONNECTING="connecting",n.OPEN="open",n.RECONNECTING="reconnecting"}(f||(f={}));u={},(0,s.Z)(u,i.CLOSED,f.CLOSED),(0,s.Z)(u,i.CONNECTING,f.CONNECTING),(0,s.Z)(u,i.OPEN,f.OPEN)},81568:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return w}});var r=t(77837),u=t(38860),o=t.n(u),i=t(89565),c=t.n(i),l=t(82684),a=t(38276),s=t(55485),f=t(97618),d=t(2367),v=t(21831),p=t(75582),E=t(83455),m=t(22271),g=t(10360),N=t(4383),T=t(72619),O=t(87432),h=t(81728);function S(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{autoReconnect:!0,maxConnectionAttempts:10},t=e.autoReconnect,r=e.maxConnectionAttempts,u=(0,l.useRef)(r),o=(0,l.useRef)(null),i=(0,l.useRef)(null),c=(0,l.useState)([]),a=c[0],s=c[1],f=(0,l.useState)([]),d=f[0],S=f[1],C=(0,l.useState)([]),b=C[0],R=C[1],_=(0,l.useState)(g.Wk.CONNECTING),I=_[0],Z=_[1],P=(0,E.Db)((function(e){return S((function(n){return[].concat((0,v.Z)(n),[null])})),m.ZP.code_executions.useCreate()({code_execution:{message:null==e?void 0:e.message,message_request_uuid:(0,h.Mp)(),timestamp:Number(new Date),uuid:n}})}),{onSuccess:function(n){return(0,T.wD)(n,{callback:function(n){(0,O.L1)()&&console.log("useEventStreams.createMessage",n),null!=n&&n.server_sent_event&&R((function(e){return[].concat((0,v.Z)(e),[null==n?void 0:n.server_sent_event])}))},onErrorCallback:function(n){s((function(e){return[].concat((0,v.Z)(e),[n])}))}})}}),x=(0,p.Z)(P,2),j=x[0],D=x[1].isLoading;function U(){var n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||(null==o?void 0:o.current);n&&(null==n||n.close()),null!=o&&o.current&&(o.current=null),Z(g.Wk.CLOSED)}function w(n,e){if(e<=0)console.log("Max reconnection attempts reached. Stopping reconnection.");else{var r=e;null!=o&&o.current&&(g.nR.OPEN===(null==o?void 0:o.current.readyState)?(Z(g.Wk.OPEN),r=null==u?void 0:u.current,clearTimeout(null==i?void 0:i.current)):U());var c=null==o?void 0:o.current;c||(console.log("Connecting to server..."),o.current=new EventSource((0,N.if)(n)),(c=null==o?void 0:o.current)&&(c.onopen=function(n){(0,O.L1)()&&console.log("useEventStreams.onopen",c,n),Z(g.Wk.OPEN)},c.onmessage=function(e){(0,O.L1)()&&console.log("useEventStreams.onmessage",e);var t=JSON.parse(e.data);t.uuid===n&&S((function(n){return[].concat((0,v.Z)(n),[t])}))},c.onerror=function(e){console.error("EventSource failed with error: ",e),s((function(n){return[].concat((0,v.Z)(n),[e])})),U(),t&&(Z(g.Wk.RECONNECTING),clearTimeout(null==i?void 0:i.current),i.current=setTimeout((function(){console.log("Reconnecting to server witth ".concat(r," attempt(s) remaining...")),w(n,r-1)}),1e3*(Math.max(0,(null==u?void 0:u.current)-r)+1)))}))}}return(0,l.useEffect)((function(){w(n,1+(t&&(null==u?void 0:u.current)||0));var e=null==o?void 0:o.current;return function(){U(e)}}),[t,n]),{errors:a,events:d,loading:D,messages:b,recentEvent:null==d?void 0:d[(null==d?void 0:d.length)-1],sendMessage:j,status:I}}var C=t(3917),b=t(92083),R=t.n(b),_=t(35576),I=t(16488),Z=t(70320),P=t(71180),x=t(30160),j=t(28598);function D(n){var e=n.error,t=(0,d.Z)({response:{error:e},stackTraceVisible:!0,tracebackVisible:!0}),r=t.displayMessage,u=t.exception,o=t.links,i=t.stackTrace,c=t.traceback;return(0,j.jsxs)("div",{children:[(0,j.jsx)(x.ZP,{bold:!0,large:!0,children:"Error"}),r&&(0,j.jsx)(a.Z,{mt:1,children:r}),u&&(0,j.jsx)(a.Z,{mt:1,children:u}),c&&(0,j.jsx)(a.Z,{mt:2,children:c}),i&&(0,j.jsx)(a.Z,{mt:2,children:i}),o]})}function U(n){var e=n.uuid,t=(0,Z.qB)(),r=(0,l.useState)(""),u=r[0],o=r[1],i=S(e),a=i.errors,d=i.events,v=i.loading,p=i.sendMessage,E=i.status;null!=a&&a.length&&console.log(a);var m=(0,l.useMemo)((function(){var n,e;return null==d||null===(n=d[(null==d?void 0:d.length)-1])||void 0===n||null===(e=n.result)||void 0===e?void 0:e.error}),[d]),N=(0,l.useMemo)((function(){return null==d?void 0:d.filter((function(n){return!!n}))}),[d]),T=(0,l.useMemo)((function(){var n;return(null==N||null===(n=N.filter((function(n){var e;return(null==n||null===(e=n.result)||void 0===e?void 0:e.type)===g.XM.STDOUT})))||void 0===n?void 0:n.length)||0}),[N]);return console.log(d),(0,j.jsxs)("div",{children:[m&&(0,j.jsx)(D,{error:m}),null==N?void 0:N.map((function(n,e){if(!n)return null;var r=n.event_uuid,u=n.result,o=n.timestamp,i=u||{output:null,output_text:null},l=(i.output,i.output_text),a=(0,h.NE)("",String(T).length-String(e).length,"&nbsp;")+"[".concat(e,"]");return(0,j.jsx)("div",{children:(0,j.jsxs)(s.ZP,{alignItems:"flex-start",fullWidth:!0,justifyContent:"space-between",children:[(0,j.jsx)(f.Z,{children:(0,j.jsxs)(x.ZP,{monospace:!0,preWrap:!0,children:[(0,j.jsx)(x.ZP,{default:!0,inline:!0,monospace:!0,children:(0,j.jsx)("span",{dangerouslySetInnerHTML:{__html:a}})})," ",(0,j.jsx)(c(),{children:l})]})}),(0,j.jsx)(x.ZP,{monospace:!0,muted:!0,children:(0,I.Uc)(R()(o).format(C.BL),t,C.BL)})]})},r)})),(0,j.jsx)(_.Z,{autoGrow:!0,label:"Message",monospace:!0,name:"message",onChange:function(n){return o(n.target.value)},rows:12}),(0,j.jsxs)(P.ZP,{loading:v,onClick:function(){return p({message:u})},children:["Send Message (",E,")"]})]})}U.getInitialProps=function(){var n=(0,r.Z)(o().mark((function n(e){var t;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.query.uuid,n.abrupt("return",{uuid:t});case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();var w=U},91185:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/test",function(){return t(81568)}])}},function(n){n.O(0,[9774,2888,179],(function(){return e=91185,n(n.s=e);var e}));var e=n.O();_N_E=e}]);